services:
  planin-fe:
    image: planin-fe:latest
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "${PORT:-3002}:${PORT:-3002}"
    environment:
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
      - PORT=${PORT:-3002}
      - HOSTNAME=0.0.0.0
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"

      # HTTP -> HTTPS redirect router (web)
      - "traefik.http.routers.planin-fe-web.entrypoints=web"
      - "traefik.http.routers.planin-fe-web.rule=Host(`planin.terra-dev.web.id`)"
      - "traefik.http.routers.planin-fe-web.middlewares=redirect-to-https@file"

      # HTTPS router (websecure)
      - "traefik.http.routers.planin-fe-websecure.entrypoints=websecure"
      - "traefik.http.routers.planin-fe-websecure.rule=Host(`planin.terra-dev.web.id`)"
      - "traefik.http.routers.planin-fe-websecure.tls=true"
      - "traefik.http.routers.planin-fe-websecure.tls.certresolver=letsencrypt"

      # âœ… ini yang paling penting: upstream port
      - "traefik.http.services.planin-fe.loadbalancer.server.port=3002"
